<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Zend Framework's event-driven MVC layer, including MVC Applications, Controllers, and Plugins.">  
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>v2.X to v2.7 - zend-mvc - Zend Framework Docs</title>

    <link rel="stylesheet" href="../../css/styles-f3b53f5ceb.css">
</head>
<body id="page-top">

    
    <div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">

            
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="../../img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">

            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>

            
            
                <div class="nav navbar-nav navbar-collapse visible-xs-block ">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">zend-mvc</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            
                
                    <li class="subnavigation__list-item ">
                        <a href="../../intro/" class="subnavigation__link">Introduction</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item ">
                        <a href="../../quick-start/" class="subnavigation__link">Quick Start</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">Reference</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../services/" class="subnavigation__link">Default Services</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../routing/" class="subnavigation__link">Routing</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../mvc-event/" class="subnavigation__link">The MVC Event</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../send-response-event/" class="subnavigation__link">The SendResponse Event</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../controllers/" class="subnavigation__link">Available Controllers</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../plugins/" class="subnavigation__link">Controller Plugins</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../examples/" class="subnavigation__link">Examples</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../middleware/" class="subnavigation__link">Dispatching PSR-7 Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Migration</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../" class="subnavigation__link">Migration Overview</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">v2.X to v2.7</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../to-v3-0/" class="subnavigation__link">v2.X to v3.0</a>
    </li>

            
        </ul>
    </li>

                            
                        </ul>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">Cookbook</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/automating-controller-factories/" class="subnavigation__link">Automating controller factories</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/middleware-in-listeners/" class="subnavigation__link">Using middleware within event listeners</a>
    </li>

                            
                        </ul>
                    </li>
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="nav navbar-nav navbar-collapse visible-xs-block">
                <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</div>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation

                    
                        <small class="header__subtitle">zend-mvc</small>
                    
                </h1>
            </div>

            
            <div class="col-xs-4 text-right">
                
                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/zendframework/zend-mvc/" class="header__link header__link--github" title="Go to repository of zend-mvc">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="laminas-announcement">
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                Zend Framework transitions to the Linux Foundation. <a href="https://getlaminas.org">Learn More.</a>
            </div>
        </div>
    </div>
</div>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-xs-12 content" role="main">
            <!-- content:begin -->
                
                    <ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
    <li><a href="https://framework.zend.com/">Home</a></li>

    
        <li><a href="https://docs.zendframework.com/">Documentation</a></li>

        
            <li><a href="../..">zend-mvc</a></li>

            
                
                    <li>Migration</li>
                
            
                
                    <li>Reference</li>
                
            

            <li class="active">v2.X to v2.7</li>
        
    
</ol>


    
        <h2 class="chapter__headline">Migration</h2>
    

    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">In This Article</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#middleware" class="toc__link">Middleware</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#application" class="toc__link">Application</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#eventmanageraware-initializers" class="toc__link">EventManagerAware initializers</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#servicelocatoraware-initializers" class="toc__link">ServiceLocatorAware initializers</a>
                    </li>
                
            </ul>
        </div>
    


    <h1 id="upgrading-to-27">Upgrading to 2.7</h1>
<h2 id="middleware">Middleware</h2>
<p>zend-mvc now registers <code>Zend\Mvc\MiddlewareListener</code> as a dispatch listener at
a priority higher than <code>Zend\Mvc\DispatchListener</code>, allowing dispatch of
<a href="http://www.php-fig.org/psr/psr-7/">PSR-7</a> middleware. Read the
<a href="../../middleware/">middleware chapter</a> for details on how to use this new feature.</p>
<h2 id="application">Application</h2>
<p>The constructor signature of <code>Zend\Mvc\Application</code> has changed. Previously, it
was:</p>
<pre class="codehilite"><code class="language-php">__construct($configuration, ServiceManager $serviceManager)</code></pre>

<p>and internally, it pulled the services <code>EventManager</code>, <code>Request</code>, and <code>Response</code>
from the provided <code>$serviceManager</code> during initialization.</p>
<p>The new constructor signature provides optional arguments for injecting the
event manager, request, and response:</p>
<pre class="codehilite"><code class="language-php">__construct(
    $configuration,
    ServiceManager $serviceManager,
    EventManager $events = null,
    RequestInterface $request = null,
    ResponseInterface $response = null
)</code></pre>

<p>This change makes all dependencies explicit. Starting in v3.0, the new arguments
will be <em>required</em>.</p>
<p>The factory <code>Zend\Mvc\Service\ApplicationFactory</code> was updated to follow the new
signature.</p>
<p>This change should only affect users who are manually instantiating the
<code>Application</code> instance.</p>
<h2 id="eventmanageraware-initializers">EventManagerAware initializers</h2>
<p>zend-mvc provides two mechanisms for injecting event managers into
<code>EventManagerAware</code> objects. One is the "EventManagerAwareInitializer"
registered in <code>Zend\Mvc\Service\ServiceManagerConfig</code>, and the other is the
<code>Zend\Mvc\Controller\ControllerManager::injectEventManager()</code> initializer. In
both cases, the logic was updated to be forwards compatible with
zend-eventmanager v3.</p>
<p>Previously each would check if the instance's <code>getEventManager()</code> method
returned an event manager instance, and, if so, inject the shared event manager:</p>
<pre class="codehilite"><code class="language-php">$events = $instance-&gt;getEventManager();
if ($events instanceof EventManagerInterface) {
    $events-&gt;setSharedManager($container-&gt;get('SharedEventManager'));
}</code></pre>

<p>In zend-eventmanager v3, event managers are now injected with the shared
manager at instantiation, and no setter exists for providing the shared manager.
As such, the above logic changed to:</p>
<pre class="codehilite"><code class="language-php">$events = $instance-&gt;getEventManager();
if (! $events || ! $events-&gt;getSharedManager()) {
    $instance-&gt;setEventManager($container-&gt;get('EventManager'));
}</code></pre>

<p>In other words, it re-injects with a new event manager instance if the instance
pulled does not have a shared manager composed.</p>
<p>This likely will not cause regressions in existing code, but may be something to
be aware of if you were previously depending on lazy-loaded event manager
state.</p>
<h2 id="servicelocatoraware-initializers">ServiceLocatorAware initializers</h2>
<p>zend-servicemanager v3.0 removes <code>Zend\ServiceManager\ServiceLocatorAwareInterface</code>.
Since zend-mvc provides initializers around that interface, they needed updates
to allow both forwards compatibility with zend-servicemanager v3 as well as
backwards compatibility with existing applications.</p>
<p>This was accomplished in two ways:</p>
<ul>
<li>The abstract controller implementations no longer implement
  <code>ServiceLocatorAwareInterface</code>, but continue to define the methods that the
  interface defines (namely <code>setServiceLocator()</code> and <code>getServiceLocator()</code>.</li>
<li>The initializers registered by <code>Zend\Mvc\Service\ServiceManagerConfig</code> and
  <code>Zend\Mvc\Controller\ControllerManager</code> now use duck-typing to determine if
  an instance requires container injection; if so it will do so.</li>
</ul>
<p>However, we also maintain that service locator injection is an anti-pattern;
dependencies should be injected directly into instances instead. As such,
starting in 2.7.0, we now emit a deprecation notice any time an instance is
injected by one of these initializers, and we plan to remove the initializers
for version 3.0. The deprecation notice includes the name of the class, to help
you identify what instances you will need to update before the zend-mvc v3
release.</p>
<p>To prepare your code, you will need to do the following within your controller:</p>
<ul>
<li>Find all cases where you call <code>getServiceLocator()</code>, and identify the services
  they retrieve.</li>
<li>Update your controller to accept these services via the constructor.</li>
<li>If you have not already, create a factory class for your controller.</li>
<li>In the factory, pull the appropriate services and pass them to the
  controller's constructor.</li>
</ul>
<p>As an example, consider the following code from a controller:</p>
<pre class="codehilite"><code class="language-php">$db = $this-&gt;getServiceLcoator()-&gt;get('Db\ApplicationAdapter');</code></pre>

<p>To update your controller, you will:</p>
<ul>
<li>Add a <code>$db</code> property to your class.</li>
<li>Update the constructor to accept the database adapter and assign it to the
  <code>$db</code> property.</li>
<li>Change the above line to either read <code>$db = $this-&gt;db;</code> <em>or just use the
  property directly</em>.</li>
<li>Add a factory that pulls the service and pushes it into the controller.</li>
</ul>
<p>The controller then might look like the following:</p>
<pre class="codehilite"><code class="language-php">use Zend\Db\Adapter\AdapterInterface;
use Zend\Mvc\Controller\AbstractActionController;

class YourController extends AbstractActionController
{
    private $db;

    public function __construct(AdapterInterface $db)
    {
        $this-&gt;db = $db;
    }

    public function someAction()
    {
        $results = $this-&gt;db-&gt;query(/* ... */);
        /* ... */
    }
}</code></pre>

<p>A factory would look like the following:</p>
<pre class="codehilite"><code class="language-php">use Interop\Container\ContainerInterface;

class YourControllerFactory
{
    public function __invoke(ContainerInterface $container)
    {
        return new YourController($container-&gt;get('Db\ApplicationAdapter'));
    }
}</code></pre>

<p>You then also need to ensure the controller manager knows about the factory. It
likely already does, as an invokable; you will redefine it as a factory in
your <code>module.config.php</code>:</p>
<pre class="codehilite"><code class="language-php">return [
    'controllers' =&gt; [
        'factories' =&gt; [
            YourController::class =&gt; YourControllerFactory::class,
            /* ... */
        ],
        /* ... */
    ],
    /* ... */
];</code></pre>

<p>While this may seem like more steps, doing so ensures your code has no hidden
dependencies, improves the testability of your code, and allows you to substitute
alternatives for either the dependencies or the controller itself.</p>
<h4 id="optional-dependencies">Optional dependencies</h4>
<p>In some cases, you may have dependencies that are only required for some
execution paths, such as forms, database adapters, etc. In these cases, you have
two approaches you can use:</p>
<ul>
<li>Split your controller into separate responsibilities, and use the more
  specific controllers. This way you don't need to inject dependencies that are
  only used in some actions. (We recommend doing this regardless, as it helps
  keep your code more maintainable.)</li>
<li>Use <a href="http://docs.zendframework.com/zend-servicemanager/lazy-services/">lazy services</a>.
  When you configure these, zend-servicemanager gives you a proxy instance that,
  on first access, loads the full service. This allows you to delay the most
  expensive operations until absolutely needed.</li>
</ul>



    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../to-v3-0/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>



    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/zendframework/zend-mvc/edit/master/docs/book/migration/to-v2-7.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            <!-- content:end -->
            </div>
            <div class="col-md-3 col-xs-12 sidebar">
                
                    <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">zend-mvc</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            
                
                    <li class="subnavigation__list-item ">
                        <a href="../../intro/" class="subnavigation__link">Introduction</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item ">
                        <a href="../../quick-start/" class="subnavigation__link">Quick Start</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">Reference</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../services/" class="subnavigation__link">Default Services</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../routing/" class="subnavigation__link">Routing</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../mvc-event/" class="subnavigation__link">The MVC Event</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../send-response-event/" class="subnavigation__link">The SendResponse Event</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../controllers/" class="subnavigation__link">Available Controllers</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../plugins/" class="subnavigation__link">Controller Plugins</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../examples/" class="subnavigation__link">Examples</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../middleware/" class="subnavigation__link">Dispatching PSR-7 Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Migration</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../" class="subnavigation__link">Migration Overview</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">v2.X to v2.7</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../to-v3-0/" class="subnavigation__link">v2.X to v3.0</a>
    </li>

            
        </ul>
    </li>

                            
                        </ul>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">Cookbook</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/automating-controller-factories/" class="subnavigation__link">Automating controller factories</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/middleware-in-listeners/" class="subnavigation__link">Using middleware within event listeners</a>
    </li>

                            
                        </ul>
                    </li>
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>&copy; 2006-2019 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.zendframework.com" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://zendframework-slack.herokuapp.com" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://tinyletter.com/mwopzend" class="support__link" title="Newsletter"><i class="fa fa-envelope"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://framework.zend.com/blog/feed-rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://framework.zend.com/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script>
        var base_url = '../..',
            siteName = 'zend-mvc';
    </script>
    <script src="../../js/scripts-8d7ae56abf.js"></script>
        <script src="../../search/main.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>



</body>


</html>
